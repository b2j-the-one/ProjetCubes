@model IEnumerable<Cubes.Web.Models.Ressource>

@{
    ViewBag.Title = "Ressources";
}

<br />
<br />

<div class="pull-right">
    @using (Html.BeginForm("Publications", "Ressources", FormMethod.Get))
    {
        @Html.TextBox("search")
        <input type="submit" value="Rechercher" />
    }

    @*<input type="text" id="txtSearch" placeholder="Rechercher par catégorie..." />*@
</div>
<br />
<br />
<br />
<br />


@foreach (var item in Model)
{
    <table class="table table-bordered">
        <tr>
            <td>
                <div class="pull-left" style="margin-top: 10px; margin-bottom: 10px">
                    <span style="margin-right:15px; font-weight: bold">
                        <img src="~/Content/Files/user_avatar.png" class="img-circle" alt="Photo de l'utiliisateur" style="width:30px;height:30px;max-width: 100%; height: auto;" />
                        @item.User
                    </span>
                    <span style="margin-right:10px; margin-left: 100px">
                        @item.DateCreation
                    </span>
                    <br />
                    <span style="margin-top: 35px;margin-bottom:35px;margin-left: 35px">
                        @item.Nom
                    </span>
                    <br />
                    <span class="alert-danger" style="margin-top: 35px;margin-bottom:35px;margin-left: 35px">
                        @item.Categorie.Libelle
                    </span>
                    @*<div style="border:1px solid gray; border-radius: 2px; background-color:lightgray;width:500px;max-width: 100%; height: auto;">
                        <span style="margin-right:15px; font-weight: bold">
                            <img src="~/Content/Files/user_avatar.png" class="img-circle" alt="Photo de l'utiliisateur" style="width:30px;height:30px;max-width: 100%; height: auto;" />
                            @item.User
                        </span>
                        <span style="margin-right:10px; margin-left: 100px">
                            @item.DateCreation
                        </span>
                        <br />
                        <span style="margin-top: 35px;margin-bottom:35px;margin-left: 35px">
                            @item.Nom
                        </span>
                        <br />
                        <span class="alert-danger" style="margin-top: 35px;margin-bottom:35px;margin-left: 35px">
                            @item.Categorie.Libelle
                        </span>
                    </div>*@
                    <div style="margin-left: 35px; border-radius: 10px;width:auto;max-width: 100%; height: auto;">

                        @if (!string.IsNullOrEmpty(item.Fichier))
                        {
                            if (item.Fichier.Contains(".jpg") || item.Fichier.Contains(".png") || item.Fichier.Contains(".gif") || item.Fichier.Contains(".tiff") || item.Fichier.Contains(".jfif"))
                            {
                                <img src="@Url.Content(item.Fichier)" alt="Fichier joint" style="width:350px;height:350px;max-width: 100%; height: auto;" />
                            }
                            else if (item.Fichier.Contains(".mp4"))
                            {
                                <div class="video-frame">
                                    <video style="width:350px; height:350px" controls download>
                                        <source src="@Url.Content(item.Fichier)" type="video/mp4" au autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </video>
                                </div>
                            }
                            else if (item.Fichier.Contains(".avi"))
                            {
                                <div class="video-frame">
                                    <video style="width:350px; height:350px" controls>
                                        <source src="@Url.Content(item.Fichier)" type="video/avi" autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </video>
                                </div>
                            }
                            else if (item.Fichier.Contains(".webm"))
                            {
                                <div class="video-frame">
                                    <video style="width:350px; height:350px" controls>
                                        <source src="@Url.Content(item.Fichier)" type="video/webm" autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </video>
                                </div>
                            }
                            else if (item.Fichier.Contains(".mp3"))
                            {
                                <div class="audio-frame">
                                    <audio style="width:350px; height:350px" controls>
                                        <source src="@Url.Content(item.Fichier)" type="audio/mp3" autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </audio>
                                </div>
                            }
                            else if (item.Fichier.Contains(".aac"))
                            {
                                <div class="audio-frame">
                                    <audio style="width:350px; height:350px" controls>
                                        <source src="@Url.Content(item.Fichier)" type="audio/aac" autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </audio>
                                </div>
                            }
                            else if (item.Fichier.Contains(".mp4"))
                            {
                                <div class="audio-frame">
                                    <audio style="width:350px; height:350px" controls>
                                        <source src="@Url.Content(item.Fichier)" type="audio/mp4" autstart="true" loop="false" runat="server" style="border: gray 1px solid" />
                                    </audio>
                                </div>
                            }
                            else if (item.Fichier.Contains(".pdf"))
                            {
                                <br /><br />
                                <p style="width:350px;height:350px;"><a href="@Url.Content(item.Fichier)" target="_blank"><img src="~/Content/Files/mon_pdf.png" /></a></p>
                            }
                            else if (item.Fichier.Contains(".docx"))
                            {
                                <br /><br />
                                <p style="width:350px;height:350px;"><a href="@Url.Content(item.Fichier)" download><img src="~/Content/Files/word.jpg" /></a></p>
                            }
                            else if (item.Fichier.Contains(".xls") || item.Fichier.Contains(".xlsx"))
                            {
                                <br /><br />
                                <p style="width:350px;height:350px;"><a href="@Url.Content(item.Fichier)" download><img src="~/Content/Files/excel.jpg" /></a></p>
                            }
                            else if (item.Fichier.Contains(".pptx"))
                            {
                                <br /><br />
                                <p style="width:350px;height:350px;"><a href="@Url.Content(item.Fichier)" download><img src="~/Content/Files/power_point.png" />Télécharger</a></p>
                            }
                        }
                    </div>

                    @foreach (var comment in item.Commentaires)
                    {
                        <br /><br />
                        <div class="pull-left" style="margin-top: 10px; margin-bottom: 10px">
                            <span style="margin-right:15px; font-weight: bold">
                                <img src="@Url.Content(comment.User.Photo)" class="img-circle" alt="Photo de l'utiliisateur" style="width:30px;height:30px;max-width: 100%; height: auto;" />
                                @comment.User.NomComplet
                            </span>
                            <span style="margin-right:10px">
                                @comment.DateCommentaire
                            </span>
                            <div style="border:1px solid gray; margin-left: 35px; border-radius: 10px; background-color:lightgray;width:auto;max-width: 100%; height: auto;">
                                <span style="margin-top: 35px;margin-bottom:35px;margin-left: 10px">
                                    @comment.Text
                                </span>
                            </div>
                        </div>
                    }
                    @using (Html.BeginForm("PostComment", "Ressources", FormMethod.Post))
                    {
                        <div style="margin-bottom: 10px" class="pull-left">
                            <input type="text" name="CommentText" placeholder="Ajouter un commentaire..." style="width: auto; max-width: 100%; height: 50px; border-radius: 10px; margin-left: 35px" />
                            <input type="hidden" name="IdRessource" value="@item.IdRessource" />
                            <br />
                            <input type="submit" value="Poster" class="btn btn-success" style="margin-top: 10px; margin-left: 35px" />
                        </div>
                    }
                </div>
            </td>
        </tr>
    </table>
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $("#txtSearch").on("keyup", function () {
        var txtenter = $(this).val();
        $("table tr").each(function (results) {
            if (results !== 0) {
                var id = $(this).find("td:span-child(4)").text();
                if (id.indexOf(txtenter) !== 0 && id.toLowerCase().indexOf(txtenter.toLowerCase()) < 0) {
                    $(this).hide();
                }
                else {
                    $(this).show();
                }
            }
        });
    });
</script>